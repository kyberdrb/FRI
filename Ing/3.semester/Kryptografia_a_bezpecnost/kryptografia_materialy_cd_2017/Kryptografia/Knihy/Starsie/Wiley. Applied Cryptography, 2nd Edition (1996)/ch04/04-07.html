<HTML>
<HEAD>
<META name=vscategory content="Security Programming Languages">

<META name=vsisbn content="0471128457">
<META name=vstitle content="Applied Cryptography, Second Edition: Protocols,  Algorthms, and Source Code in C (cloth)">
<META name=vsauthor content="Bruce Schneier">
<META name=vsimprint  content="Wiley Computer Publishing ">
<META name=vspublisher content="John Wiley & Sons, Inc.">
<META name=vspubdate content="1/1/96">

<TITLE>APPLIED CRYPTOGRAPHY, SECOND EDITION: Protocols, Algorithms, and Source Code in C:Intermediate Protocols</TITLE>
<!-- BEGIN HEADER -->
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<SCRIPT>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//-->
</SCRIPT>

</HEAD>
<body bgcolor="ffffff" link="#006666" alink="#006666" vlink="#006666">
	<table width="640" border="0" cellpadding="0" cellspacing="0">
		<tr valign="top">
		<td>

<!--  Begin Ads ITKBAN.BOOKS //-->

<a href="/adclick.html/CID=00000c5933d6f71200000000/site=itknowledge/area=itk.books/aamsz=468x60?ACC_TIME%%" TARGET="_blank">
<img src="http://mojofarm.sjc.mediaplex.com/adserver/banner_request/505-1403-1125?25770"></a>
<!-- http://mojofarm.sjc.mediaplex.com/adserver/click_thru_request/505-1403-1125?25770 -->


<!-- ITKBAN.BOOKS End Ads //--></td>
		<td>

<!--  Begin Ads ITKBAN //-->

<CENTER><A HREF="/adclick.html/CID=00000b452954e8a400000000/site=itknowledge/area=itk/aamsz=160x60/position=top" TARGET=_top>
<IMG BORDER=0 SRC="http://adimages.earthweb.com/images/ads/160x60/compaq_dtm_sponsor.gif" 
ALT="" ></A>
<BR><A HREF="/adclick.html/CID=00000b452954e8a400000000/site=itknowledge/area=itk/aamsz=160x60/position=top" TARGET=_top>

</A></CENTER><BR>


<!-- ITKBAN End Ads //--></td>
		</tr>
		<tr><td height="1" colspan="2" bgcolor="#CCCCCC"><img src="/images/white.gif" border=0 alt=""></td></tr>
	</TABLE>
<!-- END HEADER -->
<!-- BEGIN SUB HEADER -->
	
	<table bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" border="0" width="100%">
 		
		
<!-- ITK LOGO Banner -->
	
	<tr>
		<td align="left" valign="top" bgcolor="#FFFFFF"><script>
function GetCookie (name)
{
   var arg = name + "=";
   var alen = arg.length;
   var clen = document.cookie.length;
   var i = 0;
   while (i < clen)
   {
      var j = i + alen;
      if (document.cookie.substring(i, j) == arg) {
         var end = document.cookie.indexOf (";", j);
         if (end == -1)
            end = document.cookie.length;
         return unescape(document.cookie.substring(j, end));
      }
      i = document.cookie.indexOf(" ", i) + 1;
      if (i == 0) break;
   }
   return null;
}
var m1='<IMG SRC="';
var m2='/images/itk-logo.gif';
var m3='" VSPACE="10" WIDTH=434 HEIGHT=58 ALT="ITKnowledge" border="0">';
var gifstr=GetCookie("UsrType");
if((gifstr!=0 )  && (gifstr!=null)) { m2=gifstr; }
document.write(m1+m2+m3);
</script>
</td>
	</tr>
<!-- END of ITK LOGO Banner -->
	
<!-- ITK TOPNAV -->
	
	<tr>
		<td align="left" valign="top" nowrap>
<a href="/"><img src="/images/home1.gif" width=38 height=37 alt="home" border="0"></a>&nbsp;<a href="/pick-account.html"><img src="/images/accountinfo.gif" width=70 height=37 alt="account info" border="0"></a>&nbsp;<a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/subscribe2.gif" width=56 height=37 alt="subscribe" border="0" hspace="6"></a>&nbsp;<a href="/PSUser/psuserauth.htm?cmd=login&URI=/"><img src="/images/login1.gif" width=33 height=37 alt="login" hspace="5" border="0"></a>&nbsp;<a href="/search/"><img src="/images/search1.gif" width=43 height=37 alt="search" border="0" hspace="10"></a>&nbsp;<a href="/faq/faq.html"><img src="/images/faqs1.gif" width=40 height=37 alt="FAQ/help" border="0" hspace="0"></a>&nbsp;<a href="/sitemap.html"><img src="/images/sitemap1.gif" width=46 height=37 alt="site map" border="0" hspace="2"></a>&nbsp;<a href="/contactus.html"><img src="/images/contact1.gif" width=61 height=37 alt="contact us" border="0" hspace="4"></a><br>
		<img src="/images/white.gif" width="1" height="5" alt="" border="0">
</td>  
		</tr>
</table>


<!-- END of ITK TOPNAV -->
		
	
	
<!-- begin of ITK left NAV -->

<!-- BEGIN LEFT NAV -->

	<table width=99% border="0" cellpadding="2" cellspacing="0">
		<tr>
		<td bgcolor="#ffffff" width=120 valign="top" rowspan=8>
			
			
		<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">
			<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
			<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
			<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
			<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">
											
			<img src="/images/search5.gif" width=115 height=27 alt="" border="0"><br>
			<img src="/images/white.gif" width="1" height="5" alt="" border="0"><br>
		<table width="116" height="135"  bgcolor="#e0e0e0" border="1" bordercolor="#006666" cellpadding="3" cellspacing="0">
		<tr>
		<td width="116">
<input type="text" name="metaqueryText" value="" size="8">&nbsp;<input type="submit" name="submitbutton" value="Go!">
			<INPUT type="hidden" NAME="section_on" VALUE="on">
			<font face="Arial,helvetica" size="1">
			<SELECT NAME="metatags" style="font-size: 10; font-family: sans-serif;" size="1">
			<option value="keyword" SELECTED>Keyword
			<option value="vstitle">Title
			<option value="vsauthor">Author
			<option value="vsisbn">ISBN
			<option value="vspublisher">Publisher
			<option value="vsimprint">Imprint
			</SELECT></font><br>

			<input type="radio" name="ResultTemplate" value="itk-brief.hts" checked style="background-color: #e0e0e0;"><font face="arial, helvetica" color="#006666" size="1">Brief</font>
			<input type="radio" name="ResultTemplate" value="itk-full.hts" style="background-color: #e0e0e0;"><font face="arial, helvetica" color="#006666" size="1">Full</font><br>
			<font face="arial, helvetica" size="1">
			<img src="/images/bullet.gif" width=5 height=5 hspace="5" alt="" border="0">&nbsp;<a href="/search/"><font color="#006666">Advanced</font></a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/search/"><font color="#006666">Search</font></a><br>
			<img src="/images/bullet.gif" width=5 height=5 hspace="5" alt="" border="0">&nbsp;<a href="/search/search-tips.html"><font color="#006666">Search Tips</font></a>
			</font>
</td>
</tr>
</table>
	</form>
<!-- BROWSE BY TOPIC -->
		
		<form action="" name="catlist">			
		<img src="/images/browse5.gif" width=115 height=34 alt="" border="0">
<table width="120" height="32" border="1" cellspacing="0" cellpadding="3" bordercolor="#006666" bgcolor="#e0e0e0">
				<tr>
				<td width="117" align="center">
			<font face="Arial,helvetica" size="1">
			<SELECT NAME="cat" onChange='top.location.href=this.options[selectedIndex].value;' style="font-size: 10; font-family: sans-serif;">
			<option value="" selected>Please Select
			<option value="">-----------
			<option value="/reference/dir.components.html">Components
			<option value="/reference/dir.contentmanagement.html">Content Mgt
			<option value="/reference/dir.certification1.html">Certification
			<option value="/reference/dir.databases.html">Databases
			<option value="/reference/dir.enterprisemanagement1.html">Enterprise Mgt
			<option value="/reference/dir.funandgames1.html">Fun/Games
			<option value="/reference/dir.groupwareandcollaboration1.html">Groupware
			<option value="/reference/dir.hardware1.html">Hardware
			<option value="/reference/dir.intranetandextranetdevelopment1.html">Intranet Dev
			<option value="/reference/dir.middleware.html">Middleware
			<option value="/reference/dir.multimediaandgraphicdesign1.html">Multimedia
			<option value="/reference/dir.networkservices1.html">Networks 
			<option value="/reference/dir.operatingsystems.html">OS
			<option value="/reference/dir.productivityapplications1.html">Prod Apps
			<option value="/reference/dir.programminglanguages.html">Programming
			<option value="/reference/dir.security1.html">Security	
			<!-- <option value="/reference/dir.ewtraining1.html">Training Guides -->
			<option value="/reference/dir.userinterfaces.html">UI
			<option value="/reference/dir.webservices.html">Web Services
			<option value="/reference/dir.webmasterskills1.html">Webmaster
			<option value="/reference/dir.y2k1.html">Y2K
			<option value="">-----------
			<option value="/reference/whatsnew.html">New Titles
			<option value="">-----------
			<option value="/reference/dir.archive1.html">Free Archive		
			</SELECT>
			</font></td>
	</tr>
	</table>
	</form>
<!-- LEFT NAV SEARCH END -->

		</td>
		
<!-- PUB PARTNERS END -->
<!-- END LEFT NAV -->

<td rowspan="8" align="right" valign="top"><img src="/images/iswbls.gif" width=1 height=400 alt="" border="0"></td>
<td><img src="/images/white.gif" width="5" height="1" alt="" border="0"></td>
<!-- end of ITK left NAV -->

<!-- begin main content -->
<td width="100%" valign="top" align="left">


<!-- END SUB HEADER -->

<!--Begin Content Column -->

<FONT FACE="Arial,Helvetica" SIZE="-1">
To access the contents, click the chapter and section titles.
</FONT>
<P>
<B>Applied Cryptography, Second Edition: Protocols,  Algorthms, and Source Code in C (cloth)</B>
<FONT SIZE="-1">
<BR>
<I>(Publisher: John Wiley & Sons, Inc.)</I>
<BR>
Author(s): Bruce Schneier
<BR>
ISBN: 0471128457
<BR>
Publication Date: 01/01/96
</FONT>
<P>
<form name="Search" method="GET" action="http://search.earthweb.com/search97/search_redir.cgi">

<INPUT TYPE="hidden" NAME="Action" VALUE="Search">
<INPUT TYPE="hidden" NAME="SearchPage" VALUE="http://search.earthweb.com/search97/samples/forms/srchdemo.htm">
<INPUT TYPE="hidden" NAME="Collection" VALUE="ITK">
<INPUT TYPE="hidden" NAME="ResultTemplate" VALUE="itk-full.hts">
<INPUT TYPE="hidden" NAME="ViewTemplate" VALUE="view.hts">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="queryText" size=50 VALUE="">&nbsp;<input type="submit" name="submitbutton" value="Go!">
<INPUT type=hidden NAME="section_on" VALUE="on">
<INPUT type=hidden NAME="section" VALUE="http://www.itknowledge.com/reference/standard/0471128457/">

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471128457//-->
<!--TITLE=APPLIED CRYPTOGRAPHY, SECOND EDITION: Protocols, Algorithms, and Source Code in C//-->
<!--AUTHOR=Bruce Schneier//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=04//-->
<!--PAGES=089-091//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="04-06.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="04-08.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<H3><A NAME="Heading11"></A><FONT COLOR="#000077">4.10 Fair Coin Flips</FONT></H3>
<P>It&#146;s story time with Joe Kilian [831]:
</P>
<BLOCKQUOTE><P>Alice and Bob wanted to flip a fair coin, but had no physical coin to flip. Alice offered a simple way of flipping a fair coin mentally.
</P>
<P>&#147;First, you think up a random bit, then I&#146;ll think up a random bit. We&#146;ll then exclusive-or the two bits together, &#148; she suggested.</P>
<P>&#147;But what if one of us doesn&#146;t flip a coin at random?&#148; Bob asked.</P>
<P>&#147;It doesn&#146;t matter. As long as one of the bits is truly random, the exclusive-or of the bits should be truly random, &#148; Alice replied, and after a moment&#146;s reflection, Bob agreed.</P>
<P>A short while later, Alice and Bob happened upon a book on artificial intelligence, lying abandoned by the roadside. A good citizen, Alice said, &#147;One of us must pick this book up and find a suitable waste receptacle.&#148; Bob agreed, and suggested they use their coin-flipping protocol to determine who would have to throw the book away.</P>
<P>&#147;If the final bit is a 0, then you will pick the book up, and if it is a 1, then I will, &#148; said Alice. &#147;What is your bit?&#148;</P>
<P>Bob replied, &#147;1.&#148;</P>
<P>&#147;Why, so is mine, &#148; said Alice, slyly, &#147;I guess this isn&#146;t your lucky day.&#148;</P>
<P>Needless to say, this coin-flipping protocol had a serious bug. While it is true that a truly random bit, <I>x</I>, exclusive<I>-OR</I>ed with any independently distributed bit, <I>y</I>, will yield a truly random bit, Alice&#146;s protocol did not ensure that the two bits were distributed independently. In fact, it is not hard to verify that no mental protocol can allow two infinitely powerful parties to flip a fair coin. Alice and Bob were in trouble until they received a letter from an obscure graduate student in cryptography. The information in the letter was too theoretical to be of any earthly use to anyone, but the envelope the letter came in was extremely handy.</P>
<P>The next time Alice and Bob wished to flip a coin, they played a modified version of the original protocol. First, Bob decided on a bit, but instead of announcing it immediately, he wrote it down on a piece of paper and placed the paper in the envelope. Next, Alice announced her bit. Finally, Alice and Bob took Bob&#146;s bit out of the envelope and computed the random bit. This bit was indeed truly random whenever at least one of them played honestly. Alice and Bob had a working protocol, the cryptographer&#146;s dream of social relevance was fulfilled, and they all lived happily ever after.</P>
</BLOCKQUOTE><P>Those envelopes sound a lot like bit-commitment blobs. When Manuel Blum introduced the problem of flipping a fair coin over a modem [194], he solved it using a bit-commitment protocol:
</P>
<DL>
<DD><B>(1)</B>&nbsp;&nbsp;Alice commits to a random bit, using any of the bit-commitment schemes listed in Section 4.9.
<DD><B>(2)</B>&nbsp;&nbsp;Bob tries to guess the bit.
<DD><B>(3)</B>&nbsp;&nbsp;Alice reveals the bit to Bob. Bob wins the flip if he correctly guessed the bit.
</DL>
<P>In general, we need a protocol with these properties:
</P>
<DL>
<DD><B>&#151;</B>&nbsp;&nbsp;Alice must flip the coin before Bob guesses.
<DD><B>&#151;</B>&nbsp;&nbsp;Alice must not be able to re-flip the coin after hearing Bob&#146;s guess.
<DD><B>&#151;</B>&nbsp;&nbsp;Bob must not be able to know how the coin landed before making his guess.
</DL>
<P>There are several ways in which we can do this.
</P>
<P><FONT SIZE="+1"><B><I>Coin Flipping Using One-Way Functions</I></B></FONT></P>
<P>If Alice and Bob can agree on a one-way function, this protocol is simple:
</P>
<DL>
<DD><B>(1)</B>&nbsp;&nbsp;Alice chooses a random number, <I>x</I>. She computes <I>y</I> = <I>f</I>(<I>x</I>), where <I>f</I>(<I>x</I>) is the one-way function.
<DD><B>(2)</B>&nbsp;&nbsp;Alice sends <I>y</I> to Bob.
<DD><B>(3)</B>&nbsp;&nbsp;Bob guesses whether <I>x</I> is even or odd and sends his guess to Alice.
<DD><B>(4)</B>&nbsp;&nbsp;If Bob&#146;s guess is correct, the result of the coin flip is heads. If Bob&#146;s guess is incorrect, the result of the coin flip is tails. Alice announces the result of the coin flip and sends <I>x</I> to Bob.
<DD><B>(5)</B>&nbsp;&nbsp;Bob confirms that <I>y</I> = <I>f</I>(<I>x</I>).
</DL>
<P>The security of this protocol rests in the one-way function. If Alice can find <I>x</I> and <I>x&#180;</I>, such that <I>x</I> is even and <I>x&#180;</I> is odd, and <I>y</I> = <I>f</I>(<I>x</I>) = <I>f</I>(<I>x&#180;</I>), then she can cheat Bob every time. The least significant bit of <I>f</I>(<I>x</I>) must also be uncorrelated with <I>x</I>. If not, Bob can cheat Alice at least some of the time. For example, if <I>f</I>(<I>x</I>) produces even numbers 75 percent of the time if <I>x</I> is even, Bob has an advantage. (Sometimes the least significant bit is not the best one to use in this application, because it can be easier to compute.)</P>
<P><FONT SIZE="+1"><B><I>Coin Flipping Using Public-Key Cryptography</I></B></FONT></P>
<P>This protocol works with either public-key cryptography or symmetric cryptography. The only requirement is that the algorithm commute. That is:
</P>
<DL>
<DD><I>D</I><SUB>K1</SUB>(<I>E</I><SUB>K2</SUB>(<I>E</I><SUB>K1</SUB>(<I>M</I>))) = <I>E</I><SUB>K2</SUB>(<I>M</I>)
</DL>
<P>In general, this property is not true for symmetric algorithms, but it is true for some public-key algorithms (RSA with identical moduli, for example). This is the protocol:
</P>
<DL>
<DD><B>(1)</B>&nbsp;&nbsp;Alice and Bob each generate a public-key/private-key key pair.
<DD><B>(2)</B>&nbsp;&nbsp;Alice generates two messages, one indicating heads and the other indicating tails. These messages should contain some unique random string, so that she can verify their authenticity later in the protocol. Alice encrypts both messages with her public key and sends them to Bob in a random order.
<DL>
<DD><I>E</I><SUB>A</SUB>(<I>M</I><SUB>1</SUB>), <I>E</I><SUB>A</SUB>(<I>M</I><SUB>2</SUB>)
</DL>
<DD><B>(3)</B>&nbsp;&nbsp;Bob, who cannot read either message, chooses one at random. (He can sing &#147;eeny meeny miney moe, &#148; engage a malicious computer intent on subverting the protocol, or consult the <I>I Ching</I>&#151;it doesn&#146;t matter.) He encrypts it with his public key and sends it back to Alice.
<DL>
<DD><I>E</I><SUB>B</SUB>(<I>E</I><SUB>A</SUB>(<I>M</I>))
</DL>
<BR><I>M</I> is either <I>M</I><SUB>1</SUB> or <I>M</I><SUB>2</SUB>.
<DD><B>(4)</B>&nbsp;&nbsp;Alice, who cannot read the message sent back to her, decrypts it with her private key and then sends it back to Bob.
<DL>
<DD><I>D</I><SUB>A</SUB>(<I>E</I><SUB>B</SUB>(<I>E</I><SUB>A</SUB>(<I>M</I>))) = <I>E</I><SUB>B</SUB>(<I>M</I><SUB>1</SUB>) if <I>M</I> = <I>M</I><SUB>1</SUB>, or
<DD><I>E</I><SUB>B</SUB>(<I>M</I><SUB>2</SUB>) if <I>M</I> = <I>M</I><SUB>2</SUB>
</DL>
<DD><B>(5)</B>&nbsp;&nbsp;Bob decrypts the message with his private key to reveal the result of the coin flip. He sends the decrypted message to Alice.
<DL>
<DD><I>D</I><SUB>B</SUB>(<I>E</I><SUB>B</SUB>(<I>M</I><SUB>1</SUB>)) = <I>M</I><SUB>1</SUB> or <I>D</I><SUB>B</SUB>(<I>E</I><SUB>B</SUB>(<I>M</I><SUB>2</SUB>)) = <I>M</I><SUB>2</SUB>
</DL>
<DD><B>(6)</B>&nbsp;&nbsp;Alice reads the result of the coin flip and verifies that the random string is correct.
<DD><B>(7)</B>&nbsp;&nbsp;Both Alice and Bob reveal their key pairs so that both can verify that the other did not cheat.
</DL>
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="04-06.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="04-08.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>

[an error occurred while processing this directive]
<!-- all of the reference materials (books) have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- BEGIN SUB FOOTER -->
		<br><br>
		</TD>
    </TR>
	</TABLE>

		
	<table width="640" border=0 cellpadding=0 cellspacing=0>
		<tr>
		<td align="left" width=135><img src="/images/white.gif" width=100 height="1" alt="" border="0"></td>
		
		
<!-- END SUB FOOTER -->

<!-- all of the books have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- FOOTER -->
			
		<td width="515" align="left" bgcolor="#FFFFFF">
<font face="arial, helvetica" size="1"><b><a href="/products.html"><font color="#006666">Products</font></a>&nbsp;|&nbsp; <a href="/contactus.html"><font color="#006666">Contact Us</font></a>&nbsp;|&nbsp; <a href="/aboutus.html"><font color="#006666">About Us</font></a>&nbsp;|&nbsp; <a href="http://www.earthweb.com/corporate/privacy.html" target="_blank"><font color="#006666">Privacy</font></a> &nbsp;|&nbsp; <a href="http://www.itmarketer.com/" target="_blank"><font color="#006666">Ad Info</font></a> &nbsp;|&nbsp; <a href="/"><font color="#006666">Home</font></a></b>
		<br><br>
		
		Use of this site is subject to certain <a href="/agreement.html">Terms &amp; Conditions</a>, <a href="/copyright.html">Copyright &copy; 1996-1999 EarthWeb Inc.</a><br> 
All rights reserved.  Reproduction whole or in part in any form or medium without express written permision of EarthWeb is prohibited.</font><p>
</td>
		</tr>
</table>
</BODY>
</HTML>

<!-- END FOOTER -->

